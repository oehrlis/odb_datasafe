# OraDBA Data Safe Extension v0.7.0

**Release Date:** 2026-02-11

## Overview

Version 0.7.0 introduces significant usability improvements with problem diagnostics,
connector update automation, and comprehensive documentation enhancements. The new
help script and problem grouping features make it easier to discover tools and
troubleshoot target issues at scale.

## Highlights

- **Help script** (`odb_datasafe_help.sh`) provides discoverable tool overview with
  extracted descriptions from all scripts
- **Problem diagnostics** in `ds_target_list.sh` with `--problems` and `--group-problems`
  modes for quick identification of common issues across targets
- **Connector update automation** (`ds_connector_update.sh`) streamlines connector
  updates with bundle management and automated setup
- **Password file support** enables secure credential management with base64-encoded
  password files
- **Documentation overhaul** with enhanced navigation, standardized headers, and
  clear pointers to quickref.md and doc/ folder

## Details

### Tool Discovery

```bash
# List all available tools with descriptions
bin/odb_datasafe_help.sh

# Export as markdown or CSV
bin/odb_datasafe_help.sh -f markdown
bin/odb_datasafe_help.sh -f csv
```

The help script dynamically extracts purpose/description from script headers,
supports multiple formats, and includes documentation references.

### Problem Diagnostics

```bash
# Show NEEDS_ATTENTION targets with full details
bin/ds_target_list.sh --problems

# Group problems by type with counts
bin/ds_target_list.sh --group-problems

# Summary only (no target lists)
bin/ds_target_list.sh --group-problems --summary
```

Key capabilities:

- Full lifecycle-details displayed without truncation (80 char column)
- Groups targets by problem type with counts and affected target lists
- Summary mode shows only problem counts without detailed listings
- Supports table, JSON, and CSV formats

### Connector Update Automation

```bash
# Update connector with auto-detected home
bin/ds_connector_update.sh --connector my-connector -c MyCompartment

# Dry-run to preview changes
bin/ds_connector_update.sh --connector my-connector --dry-run

# Update with specific home directory
bin/ds_connector_update.sh --connector my-connector \
  --connector-home /u01/app/oracle/product/datasafe
```

Features:

- End-to-end automation: bundle generation, download, extraction, setup
- Password management with base64 files (etc/CONNECTOR_NAME_pwd.b64)
- Reuses existing passwords unless `--force-new-password` specified
- Auto-detects connector home or accepts explicit path
- Comprehensive dry-run support

### Password File Support

```bash
# Register with password file
export DATASAFE_PASSWORD_FILE=/path/to/user_pwd.b64
bin/ds_target_register.sh --host myhost --sid MYDB --pdb MYPDB

# Activate with separate CDB password
export DATASAFE_CDB_PASSWORD_FILE=/path/to/sys_pwd.b64
bin/ds_target_activate.sh -c MyCompartment -L INACTIVE --apply
```

Password file lookup order:

1. Explicit environment variable (DATASAFE_PASSWORD_FILE, DATASAFE_CDB_PASSWORD_FILE)
2. `<user>_pwd.b64` in ORADBA_ETC
3. `<user>_pwd.b64` in $ODB_DATASAFE_BASE/etc

### Target Activation Enhancements

```bash
# Dry-run (default)
bin/ds_target_activate.sh -c MyCompartment -L INACTIVE

# Apply changes and wait for completion
bin/ds_target_activate.sh -c MyCompartment -L INACTIVE --apply --wait-for-state
```

Changes:

- Requires explicit targets or compartment (no default scanning)
- `--apply` flag required for actual changes (default: dry-run)
- `--wait-for-state` option for synchronous execution

### Connector Management

Enhanced `lib/oci_helpers.sh` with connector operations:

- `ds_list_connectors()` - List all connectors in compartment
- `ds_resolve_connector_ocid()` - Resolve name to OCID
- `ds_resolve_connector_name()` - Resolve OCID to name
- `ds_get_connector_details()` - Get connector details
- `ds_generate_connector_bundle()` - Generate bundle with password
- `ds_download_connector_bundle()` - Download bundle to file

All functions support dry-run mode and follow existing patterns.

### Documentation Improvements

- Enhanced README.md with prominent documentation section and emojis
- Clear pointers to doc/ folder and quickref.md throughout
- Standardized script headers across all tools (OraDBA format)
- Help script references added to documentation footers
- Organized documentation links with better descriptions

### Target List Cache

```bash
# Set cache TTL (seconds)
export DS_TARGET_CACHE_TTL=300  # 5 minutes (default)

# Disable caching
export DS_TARGET_CACHE_TTL=0
```

Prevents stale lifecycle counts between script invocations by refreshing cached
target lists after TTL expires.

## Bug Fixes

- **Connector grouping** now uses `associated-resource-ids` instead of
  `connection-option` for accurate target-to-connector mapping
- **Compartment resolution** properly resolves DS_ROOT_COMP names to OCIDs
- **Null lifecycle-details** handling in problem grouping prevents errors

## Testing

- All tests passing: `make test`
- Linting clean: `make lint`
- 127+ BATS tests covering new features

## Upgrade

```bash
# From your OraDBA local base
cd ${ORADBA_LOCAL_BASE}
tar -xzf odb_datasafe-0.7.0.tar.gz

# Source OraDBA environment
source oraenv.sh
```

## Breaking Changes

None. All changes are backward compatible.

## Migration Notes

- Target activation now requires explicit `--apply` flag for actual changes
  (preserves safety with default dry-run behavior)
- Scripts with non-standard headers have been updated to OraDBA format
  (functionality unchanged)

## See Also

- [Changelog](../../CHANGELOG.md)
- [Quick Reference](../quickref.md)
- [Installation Guide](../install_datasafe_service.md)
- [Tool Overview](../../bin/odb_datasafe_help.sh) - Run to list all available scripts
