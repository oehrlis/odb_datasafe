# Release Notes v0.17.0

## Highlights

This minor release consolidates a broad set of workflow and safety improvements:

- one-page reporting and output model cleanup in `ds_target_list.sh`
- reusable target JSON replay/save workflows across analysis and export commands
- guarded Phase 3 rollout for mutating operations using local snapshots
- improved refresh resiliency when OCI reports in-progress operations

## Changed

### Consolidated Target Analysis UX (`ds_target_list.sh`)

- Normalized mode model and aliases:
  - `--mode details|count|overview|health|problems|report`
  - `--details`, `--count`, `--overview`, `--health`, `--problems`, `--report`
- Unified troubleshooting controls:
  - `--issue-view`, `--issue`, `--action`, `--no-action`
- Streamlined overview toggles:
  - `--status`, `--no-status`, `--no-members`,
    `--truncate-members`, `--no-truncate-members`
- Consolidated issue-summary table output so `health`, `problems`, and `report`
  share aligned columns (`Issue`, `Severity`, `Count`, `SIDs`, `SID %`, `Suggested Action`).
- Improved report generation efficiency by reducing repeated `jq` scans.

### One-Page Report Enhancements (`--mode report`)

- Added richer context and scope presentation (run ID, raw/selected counts, filters).
- Added coverage metrics and SID blast-radius percentages.
- Added top-SID visibility context (`top 10`, `showing X of Y`).
- Added report delta tracking via `${ODB_DATASAFE_BASE}/log/ds_target_last_report.json`.
- Improved readability for low-noise scopes by collapsing empty sections to `none`.

### JSON Replay/Save Rollout Across Scripts

- Added reusable source helpers in `lib/oci_helpers.sh` for normalized load/save and
  source collection (`ds_collect_targets_source`).
- Added `--input-json` / `--save-json` support to read-only scripts:
  - `ds_tg_report.sh`
  - `ds_find_untagged_targets.sh`
  - `ds_target_connector_summary.sh`
- Added `--input-json` / `--save-json` support to export/details workflows:
  - `ds_target_export.sh`
  - `ds_target_details.sh`

### Phase 3 Safety Rollout for Mutating Scripts

- Added guarded replay support (`--input-json` / `--save-json`) to:
  - `ds_target_refresh.sh`
  - `ds_target_update_tags.sh`
  - `ds_target_update_credentials.sh`
  - `ds_target_update_service.sh`
- Enforced fail-closed apply behavior:
  - apply from snapshot requires explicit `--allow-stale-selection`
  - freshness guard via `--max-snapshot-age` (`900`, `30m`, `24h`, `2d`, `off`)

### Logging Behavior Defaults

- Tightened default logging to quiet output (WARN/ERROR/FATAL).
- Standardized flag behavior:
  - `--quiet` keeps WARN and above
  - `--verbose` enables INFO
  - `--debug` enables full TRACE/DEBUG output

## Fixed

- `bin/ds_target_refresh.sh` now treats OCI `Conflict` responses with
  `"An operation is already in progress"` as skipped targets instead of hard failures,
  allowing refresh runs to continue and summarize accurately.
- Fixed strict `set -u` startup robustness around shared argument handling.
- Fixed false error-trap behavior in registration plan output paths.
- Fixed error-handler behavior to preserve the original failing exit code.

## Documentation

- Updated `doc/index.md` and `doc/quickref.md` examples and option references for
  consolidated target-list/reporting UX.
- Updated script help and test coverage for JSON replay/save workflows and
  mutating-script safeguards.
- Added this release note: `doc/release_notes/v0.17.0.md`.
