# Release Notes v0.16.2

## Highlights

This patch focuses on operational usability:

- hardens script behavior in mixed shell environments (`ksh` login shell + bash scripts)
- simplifies default/no-argument behavior for intent-driven scripts
- improves `ds_target_register.sh` defaults and resource-based compartment resolution
- consolidates `ds_target_list.sh` troubleshooting/overview flows into a cleaner mode model

## Changed

### No-Argument UX for Intent-Driven Scripts

- Added opt-in empty-argument help behavior (`SHOW_USAGE_ON_EMPTY_ARGS=true`) in
  `lib/common.sh`.
- Enabled usage-on-empty for scripts that require explicit intent, including:
  - `ds_target_update_connector.sh`
  - `ds_target_update_credentials.sh`
  - `ds_target_update_service.sh`
  - `ds_target_update_tags.sh`
  - `ds_target_move.sh`
  - `ds_target_register.sh`
  - `ds_target_delete.sh`
  - `ds_target_audit_trail.sh`
  - `ds_connector_register_oradba.sh`

### Target Registration Defaults (`ds_target_register.sh`)

- Registration now requires at least one resource anchor: `--host` or `--cluster`.
- When `--compartment` is omitted, target compartment resolution now tries:
  1. resource-derived compartment from `--host` / `--cluster`
  2. `DS_REGISTER_COMPARTMENT`
  3. `DS_ROOT_COMP`
- Connector defaults now support:
  1. `ONPREM_CONNECTOR_OCID`
  2. `ONPREM_CONNECTOR`
  3. random selection from `ONPREM_CONNECTOR_LIST` (or `DS_ONPREM_CONNECTOR_LIST`)

### Consolidated Target Analysis UX (`ds_target_list.sh`)

- Unified output intent into a single selector:
  - `--mode details|count|overview|issues|problems|report`
- Added report alias:
  - `--report` (equivalent to `--mode report`)
- Added selection payload persistence/replay:
  - `--save-json <file>` to persist selected target JSON
  - `--input-json <file>` to run local reporting/processing without OCI fetch
- Unified troubleshooting detail control:
  - `--issue-view summary|details`
  - `--issue <code|label>` for targeted drill-down
- Aligns overview/problem/issue workflows for faster triage on large target estates.

### One-Page Report Enhancements (`--mode report`)

- Added scope/context banner with:
  - scope type and context label
  - compartment name/OCID (when available)
  - active filters
  - raw vs selected target counts
  - run ID (`ISO timestamp + sha1[0:8]`)
- Added coverage metrics:
  - SIDâ†’CDB coverage count and percentage
  - average PDBs per CDB
  - average targets per SID
- Extended issue summary with SID blast radius (`SID %`).
- Added NEEDS_ATTENTION category breakdown (credentials, connectivity, other)
  including affected SID counts and truncated SID samples.
- Added top affected SID section (top 10 by issue count/severity).
- Added lightweight delta section vs previous report run using
  `${ODB_DATASAFE_BASE}/var/ds_target_last_report.json`.

## Fixed

- Fixed `ARGS[@]: unbound variable` failures under strict `set -u` in environments
  with `ksh` login shells by initializing shared `ARGS` in `lib/common.sh` and using
  nounset-safe expansion in script parsers (`"${ARGS[@]-}"`).
- Fixed `ds_target_register.sh` false error-trap during registration plan output by
  replacing short-circuit optional log statements with explicit `if` blocks.
- Fixed `lib/common.sh` `error_handler` to preserve original failing exit code before
  disabling ERR trap.

## Documentation

- Updated quick reference defaults and command examples for no-argument behavior,
  registration defaults, and consolidated list/troubleshooting modes.
- Updated `doc/index.md` and `doc/quickref.md` with report mode and JSON
  save/replay examples.
- Added this release note: `doc/release_notes/v0.16.2.md`.
